---
kind: pipeline
type: docker
name: Default

trigger:
  event:
    - push
    - tag

steps:

  - name: audit
    image: node:12
    commands:
      - npm audit --package-lock-only --production --audit-level=moderate

  - name: install
    image: node:12
    environment:
      NPM_CONFIG_IGNORE_SCRIPTS: true      
    commands:
      - npm ci

  #- name: test
  #  image: node:12
  #  commands:
  #    - npm test

  #- name: check-coverage
  #  image: node:12
  #  commands:
  #    - npm run coverage

  - name: build
    image: node:12
    commands:
      - npm run build
      - NPM_CONFIG_IGNORE_SCRIPTS=true npm ci --production

  - name: static-security-scan
    image: quay.io/natlibfi/njsscan
    commands:
      - njsscan dist

  - name: npm
    image: plugins/npm
    settings:
      registry: 'https://registry.npmjs.org/'
      token:
        from_secret: npm_token
    when:
      event: tag 
---
kind: pipeline
type: docker
name: Update dependencies

trigger:
  event:
    - custom
  branch:
    - master

steps:

  - name: publish
    image: quay.io/natlibfi/drone-npm-git-publish
    settings:
      git_user_name: natlibfi-melinda-automation
      git_user_email: 65649125+natlibfi-melinda-automation@users.noreply.github.com
      git_ssh_key:
        from_secret: ssh_key
      git_gpg_key:
        from_secret: gpg_key
---
kind: secret
name: npm_token
data: 2c8OWepnhT7ZPAbswXeQC4SEOoNcv7a+4yMEkjdNu5H7a0Vy9ZifcFHmW1hLIPnUcVXjVYV+JIZVXp7jnDcYTQ==
---
kind: secret
name: ssh_key
data: 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
---
kind: secret
name: gpg_key
data: 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
